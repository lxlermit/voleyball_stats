<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Stats - Волейбольная статистика</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/live_stats.css') }}">
</head>
<body>
    <div class="container">
        {% include 'live_stats/scoreboard.html' %}
        {% include 'live_stats/score_in_sets.html' %}
        {% include 'live_stats/court.html' %}
        {% include 'live_stats/additional_buttons.html' %}

        <!-- Модальное окно замены игрока -->
        <div id="substitution-modal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Выберите игрока для замены</h2>
                <div class="substitute-players-list" id="substitute-players">
                    <!-- Список запасных будет заполняться JavaScript -->
                </div>
            </div>
        </div>

        <!-- Модальное окно управления составом -->
        <div id="team-management-modal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Управление составом</h2>
                <div class="settings-buttons-container">
                    <button class="settings-action-btn" id="clear-players-btn">Очистить поле</button>
                    <button class="settings-action-btn" id="set-starting-lineup-btn">Стартовый состав</button>
                    <button class="settings-action-btn" id="rotate-clockwise-btn">По часовой</button>
                    <button class="settings-action-btn" id="rotate-counter-btn">Против часовой</button>
                </div>
            </div>
        </div>

        <!-- Существующие модальные окна -->
        <div id="remove-player-modal" class="modal">
            <div class="modal-content">
                <span class="close">X</span>
                <h2>Отправить игрока на скамейку?</h2>
                <p id="player-to-remove-info"></p>
                <div class="modal-buttons">
                    <button id="confirm-remove" class="button primary">Да</button>
                    <button id="cancel-remove" class="button cancel">Нет</button>
                </div>
            </div>
        </div>

        <div id="settings-modal" class="modal">
            <div class="modal-content settings-modal-content">
                <span class="close">X</span>
                <h2>Настройки матча</h2>
                <div class="settings-buttons-container">
                    <button class="settings-modal-btn" id="clear-to-serve">Очистка до подачи</button>
                    <button class="settings-modal-btn" id="undo-last-action">Отмена до предыдущей подачи</button>
                    <button class="settings-modal-btn" id="save-match">Сохранить</button>
                    <button class="settings-modal-btn warning-btn" id="end-set-from-settings">Конец партии</button>
                    <button class="settings-modal-btn danger-btn" id="end-game-from-settings">Конец игры</button>
                    <button class="settings-modal-btn" id="clear-players">Очистить игроков</button>
                </div>
            </div>
        </div>

        <!-- Передача данных в JavaScript -->
        <script>
            window.playersData = {{ players_data|tojson }};
            window.teamData = {{ team_data|tojson }};
            window.matchData = {{ match_data|tojson }};
        </script>

        <!-- Подключение JavaScript файлов -->
        <script src="{{ url_for('static', filename='js/live_stats/features/substitutions.js') }}"></script>
        <script src="{{ url_for('static', filename='js/live_stats/features/team_management.js') }}"></script>
        <script src="{{ url_for('static', filename='js/live_stats/features/actions.js') }}"></script>
        <script src="{{ url_for('static', filename='js/live_stats/features/score.js') }}"></script>
        <script src="{{ url_for('static', filename='js/live_stats/features/modals.js') }}"></script>
        <script src="{{ url_for('static', filename='js/live_stats/features/court.js') }}"></script>
        <script src="{{ url_for('static', filename='js/live_stats/features/players.js') }}"></script>
        <script src="{{ url_for('static', filename='js/live_stats/main.js') }}"></script>

        <!-- Инициализация -->
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Проверяем и инициализируем только те модули, которые существуют
                if (window.initSubstitutions) initSubstitutions();
                if (window.initTeamManagement) initTeamManagement();
                if (window.initActions) initActions();
                if (window.initScore) initScore();
                if (window.initCourt) initCourt();

                console.log('Основные модули инициализированы');
            });
        </script>
    </div>
</body>
</html>