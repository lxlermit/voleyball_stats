<!DOCTYPE html>
<html>
<head>
    <title>{% if team_name %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ {{ team_name }}{% else %}–ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞{% endif %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
        }
        .color-palette {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 10px 0;
        }
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid #ddd;
        }
        .color-option.selected {
            border-color: #333;
            transform: scale(1.1);
        }
        .player-card {
            border: 1px solid #ddd;
            border-left: 5px solid #FF5733;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            background: #f9f9f9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>{% if team_name %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã {{ team_name }}{% else %}–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã{% endif %}</h1>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash {{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <form method="POST" action="{{ url_for('save_team') }}">
            <div class="form-group">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã:</label>
                <input type="text" name="team_name" value="{{ team_name if team_name else '' }}"
                       {% if team_name %}readonly{% else %}required{% endif %}>
            </div>

            <div class="form-group">
                <button type="button" id="add-player-btn" class="button">+ –î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞</button>
                <button type="submit" class="button primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É</button>
                <a href="{{ url_for('index') }}" class="button cancel">–û—Ç–º–µ–Ω–∞</a>
            </div>

            <div id="players-list">
                {% for player in players %}
                    <div class="player-card" data-number="{{ player.number }}" style="border-left-color: {{ player.color }};">
                        <div class="player-header">
                            <h3>#{{ player.number }} {{ player.last_name }} {{ player.first_name }}</h3>
                            <div class="player-actions">
                                <button type="button" class="button small edit-player" data-number="{{ player.number }}">‚úèÔ∏è</button>
                                <button type="button" class="button small delete-player" data-number="{{ player.number }}">üóëÔ∏è</button>
                            </div>
                        </div>
                        <div class="player-info">
                            <p><strong>–ê–º–ø–ª—É–∞:</strong> {{ player.role }}</p>
                            <p><strong>–ü–æ–∑–∏—Ü–∏–∏:</strong> –ü–µ—Ä–µ–¥–Ω—è—è {{ player.front_pos }} | –ó–∞–¥–Ω—è—è {{ player.back_pos }}</p>
                        </div>
                        <input type="hidden" name="number_{{ loop.index }}" value="{{ player.number }}">
                        <input type="hidden" name="last_name_{{ loop.index }}" value="{{ player.last_name }}">
                        <input type="hidden" name="first_name_{{ loop.index }}" value="{{ player.first_name }}">
                        <input type="hidden" name="role_{{ loop.index }}" value="{{ player.role }}">
                        <input type="hidden" name="front_pos_{{ loop.index }}" value="{{ player.front_pos }}">
                        <input type="hidden" name="back_pos_{{ loop.index }}" value="{{ player.back_pos }}">
                        <input type="hidden" name="color_{{ loop.index }}" value="{{ player.color }}">
                    </div>
                {% endfor %}
            </div>
        </form>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–≥—Ä–æ–∫–∞ -->
    <div id="player-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modal-title">–î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞</h2>
            <form id="player-form">
                <input type="hidden" id="edit-player-number" value="">

                <div class="form-group">
                    <label for="player-number">–ù–æ–º–µ—Ä:</label>
                    <input type="number" id="player-number" min="1" max="99" required>
                </div>

                <div class="form-group">
                    <label for="player-last-name">–§–∞–º–∏–ª–∏—è:</label>
                    <input type="text" id="player-last-name" required>
                </div>

                <div class="form-group">
                    <label for="player-first-name">–ò–º—è:</label>
                    <input type="text" id="player-first-name" required>
                </div>

                <div class="form-group">
                    <label for="player-role">–ê–º–ø–ª—É–∞:</label>
                    <select id="player-role" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∞–º–ø–ª—É–∞</option>
                        <option value="–ü–∞—Å—É—é—â–∏–π">–ü–∞—Å—É—é—â–∏–π</option>
                        <option value="–î–∏–∞–≥–æ–Ω–∞–ª—å–Ω—ã–π">–î–∏–∞–≥–æ–Ω–∞–ª—å–Ω—ã–π</option>
                        <option value="–ü–µ—Ä–≤—ã–π —Ç–µ–º–ø">–ü–µ—Ä–≤—ã–π —Ç–µ–º–ø</option>
                        <option value="–î–æ–∏–≥—Ä–æ–≤—â–∏–∫">–î–æ–∏–≥—Ä–æ–≤—â–∏–∫</option>
                        <option value="–õ–∏–±–µ—Ä–æ">–õ–∏–±–µ—Ä–æ</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>–ü–æ–∑–∏—Ü–∏–∏:</label>
                    <div class="position-selectors">
                        <select id="player-front-pos" required>
                            <option value="4">–ü–µ—Ä–µ–¥–Ω—è—è 4</option>
                            <option value="3">–ü–µ—Ä–µ–¥–Ω—è—è 3</option>
                            <option value="2">–ü–µ—Ä–µ–¥–Ω—è—è 2</option>
                        </select>
                        <select id="player-back-pos" required>
                            <option value="5">–ó–∞–¥–Ω—è—è 5</option>
                            <option value="6">–ó–∞–¥–Ω—è—è 6</option>
                            <option value="1">–ó–∞–¥–Ω—è—è 1</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>–¶–≤–µ—Ç –∏–≥—Ä–æ–∫–∞:</label>
                    <div class="color-palette">
                        {% for color in ['#FF5733','#33FF57','#3357FF','#F3FF33','#FF33F3',
                                        '#33FFF3','#FF8333','#33FF83','#8333FF','#FF3383',
                                        '#8B4513','#228B22','#4169E1','#FFD700','#BA55D3',
                                        '#00FA9A','#FF6347','#4682B4','#32CD32','#9932CC'] %}
                            <div class="color-option" style="background-color: {{ color }};" data-color="{{ color }}"></div>
                        {% endfor %}
                    </div>
                    <input type="hidden" id="player-color" value="#FF5733">
                </div>

                <button type="button" id="save-player" class="button primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button type="button" class="button cancel close-modal">–û—Ç–º–µ–Ω–∞</button>
            </form>
        </div>
    </div>

    // –ó–∞–º–µ–Ω–∏—Ç–µ –≤–µ—Å—å script –≤ –∫–æ–Ω—Ü–µ —Ñ–∞–π–ª–∞ –Ω–∞ —ç—Ç–æ—Ç:

    <script>
        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        const modal = document.getElementById('player-modal');
        const modalTitle = document.getElementById('modal-title');
        const savePlayerBtn = document.getElementById('save-player');
        const addPlayerBtn = document.getElementById('add-player-btn');
        const closeBtns = document.querySelectorAll('.close, .close-modal');
        const playersList = document.getElementById('players-list');

        // –¢–µ–∫—É—â–∏–π —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–π –∏–≥—Ä–æ–∫
        let currentPlayerCard = null;

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
        addPlayerBtn.addEventListener('click', () => {
            currentPlayerCard = null;
            document.getElementById('player-form').reset();
            document.getElementById('player-color').value = '#FF5733';
            document.querySelector('.color-option[data-color="#FF5733"]').classList.add('selected');
            modalTitle.textContent = '–î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞';
            savePlayerBtn.textContent = '–î–æ–±–∞–≤–∏—Ç—å';
            modal.style.display = 'block';
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏
        closeBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                modal.style.display = 'none';
            });
        });

        // –í—ã–±–æ—Ä —Ü–≤–µ—Ç–∞
        document.querySelectorAll('.color-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.color-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                option.classList.add('selected');
                document.getElementById('player-color').value = option.dataset.color;
            });
        });

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
        savePlayerBtn.addEventListener('click', () => {
            const playerData = {
                number: document.getElementById('player-number').value,
                last_name: document.getElementById('player-last-name').value,
                first_name: document.getElementById('player-first-name').value,
                role: document.getElementById('player-role').value,
                front_pos: document.getElementById('player-front-pos').value,
                back_pos: document.getElementById('player-back-pos').value,
                color: document.getElementById('player-color').value
            };

            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!playerData.number || !playerData.last_name || !playerData.first_name || !playerData.role) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
                return;
            }

            if (currentPlayerCard) {
                // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
                updatePlayerCard(currentPlayerCard, playerData);
            } else {
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞
                addPlayerCard(playerData);
            }

            modal.style.display = 'none';
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–≥—Ä–æ–∫–∞
        function addPlayerCard(player) {
            const playerIndex = document.querySelectorAll('#players-list .player-card').length + 1;

            const cardHTML = `
                <div class="player-card" data-number="${player.number}" style="border-left-color: ${player.color};">
                    <div class="player-header">
                        <h3>#${player.number} ${player.last_name} ${player.first_name}</h3>
                        <div class="player-actions">
                            <button type="button" class="button small edit-player">‚úèÔ∏è</button>
                            <button type="button" class="button small delete-player">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="player-info">
                        <p><strong>–ê–º–ø–ª—É–∞:</strong> ${player.role}</p>
                        <p><strong>–ü–æ–∑–∏—Ü–∏–∏:</strong> –ü–µ—Ä–µ–¥–Ω—è—è ${player.front_pos} | –ó–∞–¥–Ω—è—è ${player.back_pos}</p>
                    </div>
                    <input type="hidden" name="number_${playerIndex}" value="${player.number}">
                    <input type="hidden" name="last_name_${playerIndex}" value="${player.last_name}">
                    <input type="hidden" name="first_name_${playerIndex}" value="${player.first_name}">
                    <input type="hidden" name="role_${playerIndex}" value="${player.role}">
                    <input type="hidden" name="front_pos_${playerIndex}" value="${player.front_pos}">
                    <input type="hidden" name="back_pos_${playerIndex}" value="${player.back_pos}">
                    <input type="hidden" name="color_${playerIndex}" value="${player.color}">
                </div>
            `;

            playersList.insertAdjacentHTML('beforeend', cardHTML);
            setupPlayerCardEvents(playersList.lastElementChild);
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏
        function updatePlayerCard(card, player) {
            card.style.borderLeftColor = player.color;
            card.querySelector('h3').textContent = `#${player.number} ${player.last_name} ${player.first_name}`;
            card.querySelector('.player-info p:nth-child(1)').innerHTML = `<strong>–ê–º–ø–ª—É–∞:</strong> ${player.role}`;
            card.querySelector('.player-info p:nth-child(2)').innerHTML = `<strong>–ü–æ–∑–∏—Ü–∏–∏:</strong> –ü–µ—Ä–µ–¥–Ω—è—è ${player.front_pos} | –ó–∞–¥–Ω—è—è ${player.back_pos}`;

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è
            const inputs = card.querySelectorAll('input');
            inputs[0].value = player.number;
            inputs[1].value = player.last_name;
            inputs[2].value = player.first_name;
            inputs[3].value = player.role;
            inputs[4].value = player.front_pos;
            inputs[5].value = player.back_pos;
            inputs[6].value = player.color;
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏
        function setupPlayerCardEvents(card) {
            // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
            card.querySelector('.edit-player').addEventListener('click', () => {
                currentPlayerCard = card;

                const inputs = card.querySelectorAll('input');
                document.getElementById('player-number').value = inputs[0].value;
                document.getElementById('player-last-name').value = inputs[1].value;
                document.getElementById('player-first-name').value = inputs[2].value;
                document.getElementById('player-role').value = inputs[3].value;
                document.getElementById('player-front-pos').value = inputs[4].value;
                document.getElementById('player-back-pos').value = inputs[5].value;
                document.getElementById('player-color').value = inputs[6].value;

                // –í—ã–±–æ—Ä —Ü–≤–µ—Ç–∞
                document.querySelectorAll('.color-option').forEach(opt => {
                    opt.classList.remove('selected');
                    if (opt.dataset.color === inputs[6].value) {
                        opt.classList.add('selected');
                    }
                });

                modalTitle.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä–æ–∫–∞';
                savePlayerBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
                modal.style.display = 'block';
            });

            // –£–¥–∞–ª–µ–Ω–∏–µ
            card.querySelector('.delete-player').addEventListener('click', () => {
                if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –∏–≥—Ä–æ–∫–∞?')) {
                    card.remove();
                    // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–Ω—É–º–µ—Ä–∞—Ü–∏—é –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∏–≥—Ä–æ–∫–æ–≤ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
                }
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
        document.querySelectorAll('#players-list .player-card').forEach(card => {
            setupPlayerCardEvents(card);
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª–∫–∏
        window.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        });
    </script>
</body>
</html>